# æœåŠ¡ç±»å‹å¤„ç†æµç¨‹å¯¹æ¯”

## å›¾åºŠ/æ–‡ä»¶/è§†é¢‘ç±»å‹çš„å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è®¿é—®çŸ­é“¾                                 â”‚
â”‚              http://domain.com/img-abc123                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ä»Redis/MySQLè·å–çŸ­é“¾æ•°æ®                        â”‚
â”‚   {                                                             â”‚
â”‚     "service_type": "imagebed",                                 â”‚
â”‚     "targets": [{"path": "/uploads/photo.jpg"}]                 â”‚
â”‚   }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¯†åˆ« service_type = imagebed                       â”‚
â”‚                   (ä¹Ÿå¯èƒ½æ˜¯ file æˆ– video)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  âœ… è°ƒç”¨è·¯ç”±å¼•æ“                                 â”‚
â”‚              routing_engine.select_cdn()                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                è·å–å®¢æˆ·ç«¯GeoIPä¿¡æ¯                              â”‚
â”‚    - IPåœ°å€: 120.xxx.xxx.xxx                                    â”‚
â”‚    - è¿è¥å•†: China Telecom                                      â”‚
â”‚    - å›½å®¶: CN                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                åŒ¹é…è·¯ç”±è§„åˆ™ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰                         â”‚
â”‚    è§„åˆ™: å›¾åºŠ_ç”µä¿¡ (priority 20)                                â”‚
â”‚    æ¡ä»¶: service_type=imagebed + ISP=China Telecom             â”‚
â”‚    ç›®æ ‡: imagebed_telecom                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                é€‰æ‹©CDNèŠ‚ç‚¹                                      â”‚
â”‚    imagebed_telecom (img-telecom.example.com)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ„å»ºå®Œæ•´URL                                      â”‚
â”‚    routing_engine.build_url(cdn_id, path)                       â”‚
â”‚    https://img-telecom.example.com/uploads/photo.jpg            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  302é‡å®šå‘åˆ°CDN                                 â”‚
â”‚    Location: https://img-telecom.example.com/uploads/photo.jpg  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é€šç”¨ç±»å‹çš„å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è®¿é—®çŸ­é“¾                                 â”‚
â”‚                http://domain.com/abc123                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ä»Redis/MySQLè·å–çŸ­é“¾æ•°æ®                        â”‚
â”‚   {                                                             â”‚
â”‚     "service_type": "general",                                  â”‚
â”‚     "targets": [{"url": "https://www.google.com"}]              â”‚
â”‚   }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¯†åˆ« service_type = general                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 âŒ è·³è¿‡è·¯ç”±å¼•æ“                                  â”‚
â”‚            ä¸è°ƒç”¨ routing_engine                                â”‚
â”‚          ä¸éœ€è¦CDNåˆ†æµï¼Œä¸éœ€è¦GeoIP                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç›´æ¥ä»targetsè·å–å®Œæ•´URL                           â”‚
â”‚                target.url = "https://www.google.com"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  302é‡å®šå‘åˆ°ç›®æ ‡URL                             â”‚
â”‚         Location: https://www.google.com                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®åŒºåˆ«æ€»ç»“

| å¤„ç†æ­¥éª¤ | å›¾åºŠ/æ–‡ä»¶/è§†é¢‘ | é€šç”¨ç±»å‹ |
|---------|---------------|---------|
| 1. è·å–çŸ­é“¾æ•°æ® | âœ… ç›¸åŒ | âœ… ç›¸åŒ |
| 2. è¯†åˆ«service_type | âœ… imagebed/file/video | âœ… general |
| 3. è°ƒç”¨è·¯ç”±å¼•æ“ | âœ… **è°ƒç”¨** | âŒ **è·³è¿‡** |
| 4. è·å–GeoIPä¿¡æ¯ | âœ… **éœ€è¦** | âŒ **ä¸éœ€è¦** |
| 5. åŒ¹é…è·¯ç”±è§„åˆ™ | âœ… **16æ¡è§„åˆ™** | âŒ **æ— è§„åˆ™** |
| 6. é€‰æ‹©CDNèŠ‚ç‚¹ | âœ… **16ä¸ªèŠ‚ç‚¹** | âŒ **æ— èŠ‚ç‚¹** |
| 7. æ„å»ºURL | âœ… **CDNåŸŸå + è·¯å¾„** | âŒ **ç›´æ¥ä½¿ç”¨å®Œæ•´URL** |
| 8. 302é‡å®šå‘ | âœ… åˆ°CDN | âœ… åˆ°ç›®æ ‡URL |

## æ•°æ®ç»“æ„å¯¹æ¯”

### å›¾åºŠ/æ–‡ä»¶/è§†é¢‘çš„targets
```json
{
  "service_type": "imagebed",  // æˆ– "file" æˆ– "video"
  "targets": [
    {
      "path": "/uploads/photo.jpg",  // âš ï¸ åªåŒ…å«è·¯å¾„
      "weight": 1
    }
  ]
}
```

**å¤„ç†æ–¹å¼**ï¼š
- æå– `path`
- é€šè¿‡è·¯ç”±å¼•æ“é€‰æ‹©CDNèŠ‚ç‚¹
- æ„å»ºå®Œæ•´URL: `https://cdn-domain.com` + `path`

### é€šç”¨ç±»å‹çš„targets
```json
{
  "service_type": "general",
  "targets": [
    {
      "url": "https://www.google.com",  // âš ï¸ å®Œæ•´URL
      "weight": 1
    }
  ]
}
```

**å¤„ç†æ–¹å¼**ï¼š
- ç›´æ¥ä½¿ç”¨ `url`
- ä¸éœ€è¦CDN
- ä¸éœ€è¦è·¯ç”±å¼•æ“
- ç›´æ¥302é‡å®šå‘

## ä»£ç å®ç°å¯¹æ¯”

### router.lua ä¸­çš„å¤„ç†é€»è¾‘

```lua
function select_target(link_data, client_info)
    local service_type = link_data.service_type or "general"
    local targets = link_data.targets
    
    -- ==========================================
    -- å›¾åºŠ/æ–‡ä»¶/è§†é¢‘ï¼šä½¿ç”¨è·¯ç”±å¼•æ“
    -- ==========================================
    if service_type == "imagebed" or 
       service_type == "file" or 
       service_type == "video" then
        
        -- 1. è°ƒç”¨è·¯ç”±å¼•æ“é€‰æ‹©CDN
        local cdn_id = routing_engine.select_cdn(client_info, request_info)
        logger.info(string.format("[%s] Selected CDN: %s", service_type, cdn_id))
        
        -- 2. æå–è·¯å¾„
        local path = targets[1].path or targets[1].url
        
        -- 3. æ„å»ºå®Œæ•´URL (CDNåŸŸå + è·¯å¾„)
        local final_url = routing_engine.build_url(cdn_id, path)
        
        logger.info(string.format("[%s] Final URL: %s", service_type, final_url))
        return final_url
    
    -- ==========================================
    -- é€šç”¨ç±»å‹ï¼šç›´æ¥è¿”å›ç›®æ ‡URL
    -- ==========================================
    elseif service_type == "general" or 
           service_type == "generic" then
        
        -- âš ï¸ ä¸è°ƒç”¨è·¯ç”±å¼•æ“
        -- âš ï¸ ä¸é€‰æ‹©CDN
        -- âš ï¸ ä¸æ„å»ºURL
        
        -- ç›´æ¥ä»targetsè·å–å®Œæ•´URL
        local target = strategies.select(strategy_name, healthy_targets, client_info)
        
        -- ç›´æ¥è¿”å›å®Œæ•´URL
        return target.url  -- https://www.google.com
    end
end
```

## CDNèŠ‚ç‚¹é…ç½®å¯¹æ¯”

### å½“å‰é…ç½®ï¼ˆ16ä¸ªèŠ‚ç‚¹ï¼‰

```lua
-- routing_config_simple.lua

_M.cdn_nodes = {
    -- å†…ç½‘èŠ‚ç‚¹ (1ä¸ª)
    {id = "private", domain = "localhost:8080"},
    
    -- å›¾åºŠç¾¤ç»„ (5ä¸ª)
    {id = "imagebed_unicom", domain = "img-unicom.example.com"},
    {id = "imagebed_mobile", domain = "img-mobile.example.com"},
    {id = "imagebed_telecom", domain = "img-telecom.example.com"},
    {id = "imagebed_overseas", domain = "img-overseas.example.com"},
    {id = "imagebed_default", domain = "img-cdn.example.com"},
    
    -- æ–‡ä»¶ç¾¤ç»„ (5ä¸ª)
    {id = "file_unicom", domain = "file-unicom.example.com"},
    {id = "file_mobile", domain = "file-mobile.example.com"},
    {id = "file_telecom", domain = "file-telecom.example.com"},
    {id = "file_overseas", domain = "file-overseas.example.com"},
    {id = "file_default", domain = "file-cdn.example.com"},
    
    -- è§†é¢‘ç¾¤ç»„ (5ä¸ª)
    {id = "video_unicom", domain = "video-unicom.example.com"},
    {id = "video_mobile", domain = "video-mobile.example.com"},
    {id = "video_telecom", domain = "video-telecom.example.com"},
    {id = "video_overseas", domain = "video-overseas.example.com"},
    {id = "video_default", domain = "video-cdn.example.com"}
}

-- âš ï¸ æ³¨æ„ï¼šé€šç”¨ç±»å‹ä¸éœ€è¦CDNèŠ‚ç‚¹é…ç½®
-- å› ä¸ºé€šç”¨çŸ­é“¾ç›´æ¥é‡å®šå‘åˆ°å®Œæ•´URLï¼Œä¸ç»è¿‡CDNåˆ†æµ
```

### å·²åˆ é™¤çš„é…ç½®

```lua
-- âŒ å·²åˆ é™¤ï¼šé€šç”¨ç±»å‹ä¸éœ€è¦è¿™äº›CDNèŠ‚ç‚¹
-- {id = "general_unicom", domain = "cdn-unicom.example.com"},
-- {id = "general_mobile", domain = "cdn-mobile.example.com"},
-- {id = "general_telecom", domain = "cdn-telecom.example.com"},
-- {id = "general_overseas", domain = "cdn-overseas.example.com"},
-- {id = "general_default", domain = "cdn.example.com"}
```

## è·¯ç”±è§„åˆ™é…ç½®å¯¹æ¯”

### å½“å‰é…ç½®ï¼ˆ16æ¡è§„åˆ™ï¼‰

```lua
-- routing_config_simple.lua

_M.routing_rules = {
    -- å†…ç½‘è§„åˆ™ (1æ¡)
    {priority = 10, conditions = {...}, target = "private"},
    
    -- å›¾åºŠè§„åˆ™ (5æ¡)
    {priority = 20, conditions = {service_type="imagebed", isp="ç”µä¿¡"}, target = "imagebed_telecom"},
    {priority = 21, conditions = {service_type="imagebed", isp="è”é€š"}, target = "imagebed_unicom"},
    {priority = 22, conditions = {service_type="imagebed", isp="ç§»åŠ¨"}, target = "imagebed_mobile"},
    {priority = 23, conditions = {service_type="imagebed", countryâ‰ "CN"}, target = "imagebed_overseas"},
    {priority = 24, conditions = {service_type="imagebed"}, target = "imagebed_default"},
    
    -- æ–‡ä»¶è§„åˆ™ (5æ¡)
    {priority = 30, conditions = {service_type="file", isp="ç”µä¿¡"}, target = "file_telecom"},
    {priority = 31, conditions = {service_type="file", isp="è”é€š"}, target = "file_unicom"},
    {priority = 32, conditions = {service_type="file", isp="ç§»åŠ¨"}, target = "file_mobile"},
    {priority = 33, conditions = {service_type="file", countryâ‰ "CN"}, target = "file_overseas"},
    {priority = 34, conditions = {service_type="file"}, target = "file_default"},
    
    -- è§†é¢‘è§„åˆ™ (5æ¡)
    {priority = 40, conditions = {service_type="video", isp="ç”µä¿¡"}, target = "video_telecom"},
    {priority = 41, conditions = {service_type="video", isp="è”é€š"}, target = "video_unicom"},
    {priority = 42, conditions = {service_type="video", isp="ç§»åŠ¨"}, target = "video_mobile"},
    {priority = 43, conditions = {service_type="video", countryâ‰ "CN"}, target = "video_overseas"},
    {priority = 44, conditions = {service_type="video"}, target = "video_default"}
}

-- âš ï¸ æ³¨æ„ï¼šé€šç”¨ç±»å‹ä¸éœ€è¦è·¯ç”±è§„åˆ™
-- å› ä¸ºé€šç”¨çŸ­é“¾ä¸ä½¿ç”¨è·¯ç”±å¼•æ“ï¼Œç›´æ¥é‡å®šå‘åˆ°ç›®æ ‡URL
```

### å·²åˆ é™¤çš„é…ç½®

```lua
-- âŒ å·²åˆ é™¤ï¼šé€šç”¨ç±»å‹ä¸éœ€è¦è¿™äº›è·¯ç”±è§„åˆ™
-- {priority = 50, conditions = {service_type="general", isp="ç”µä¿¡"}, target = "general_telecom"},
-- {priority = 51, conditions = {service_type="general", isp="è”é€š"}, target = "general_unicom"},
-- {priority = 52, conditions = {service_type="general", isp="ç§»åŠ¨"}, target = "general_mobile"},
-- {priority = 53, conditions = {service_type="general", countryâ‰ "CN"}, target = "general_overseas"},
-- {priority = 54, conditions = {service_type="general"}, target = "general_default"}
```

## æ€§èƒ½å½±å“

### å›¾åºŠ/æ–‡ä»¶/è§†é¢‘ç±»å‹
```
å¤„ç†æ—¶é—´: ~10-20ms
  - è·¯ç”±å¼•æ“åŒ¹é…: ~3-5ms
  - GeoIPæŸ¥è¯¢: ~2-3ms
  - CDNé€‰æ‹©: ~1-2ms
  - URLæ„å»º: ~1ms
  - é‡å®šå‘: ~3-8ms
```

### é€šç”¨ç±»å‹
```
å¤„ç†æ—¶é—´: ~3-5ms âš¡
  - è·³è¿‡è·¯ç”±å¼•æ“: 0ms
  - è·³è¿‡GeoIPæŸ¥è¯¢: 0ms
  - ç›´æ¥è·å–URL: ~1ms
  - é‡å®šå‘: ~2-4ms

æ€§èƒ½æå‡: ~50-70% ğŸš€
```

## æ€»ç»“

âœ… **ä¼˜åŒ–æ•ˆæœ**ï¼š
1. é€šç”¨çŸ­é“¾å¤„ç†é€Ÿåº¦æå‡50-70%
2. å‡å°‘16ä¸ªæ— ç”¨çš„CDNèŠ‚ç‚¹é…ç½®
3. å‡å°‘16æ¡æ— ç”¨çš„è·¯ç”±è§„åˆ™
4. é™ä½è·¯ç”±å¼•æ“çš„å¤æ‚åº¦
5. å‡å°‘GeoIPæŸ¥è¯¢æ¬¡æ•°

âœ… **æ¶æ„ä¼˜åŠ¿**ï¼š
1. èŒè´£æ¸…æ™°ï¼šä¸åŒç±»å‹é‡‡ç”¨ä¸åŒå¤„ç†é€»è¾‘
2. æ€§èƒ½ä¼˜åŒ–ï¼šé€šç”¨çŸ­é“¾ä¸ç»è¿‡å¤æ‚çš„è·¯ç”±æµç¨‹
3. æ˜“äºç»´æŠ¤ï¼šé…ç½®æ›´ç®€æ´ï¼Œè§„åˆ™æ›´æ¸…æ™°
4. çµæ´»æ‰©å±•ï¼šå¯ä»¥ç‹¬ç«‹ä¼˜åŒ–å„ç±»å‹çš„å¤„ç†é€»è¾‘

---

**æœ€åæ›´æ–°**: 2025å¹´12æœˆ10æ—¥
