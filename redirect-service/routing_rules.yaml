# ========================================
# ğŸ¯ çŸ­é“¾æœåŠ¡åˆ†æµé…ç½®
# ========================================
#
# ğŸ“‹ é…ç½®è¯´æ˜:
#   1. CDNèŠ‚ç‚¹å®šä¹‰ - é…ç½®æ‰€æœ‰å¯ç”¨çš„CDNèŠ‚ç‚¹
#   2. åˆ†æµè§„åˆ™ - å®šä¹‰æµé‡åˆ†é…è§„åˆ™ï¼ˆæŒ‰ä¼˜å…ˆçº§åŒ¹é…ï¼‰
#   3. é»˜è®¤è·¯ç”± - æ— è§„åˆ™åŒ¹é…æ—¶çš„é™çº§ç­–ç•¥
#
# âš¡ è§„åˆ™åŒ¹é…é€»è¾‘:
#   - æŒ‰ priority ä»å°åˆ°å¤§ä¾æ¬¡æ£€æŸ¥è§„åˆ™
#   - è§„åˆ™ä¸­çš„æ‰€æœ‰ conditions å¿…é¡»å…¨éƒ¨æ»¡è¶³ï¼ˆANDé€»è¾‘ï¼‰
#   - åŒ¹é…æˆåŠŸåç«‹å³è¿”å›ï¼Œä¸å†æ£€æŸ¥åç»­è§„åˆ™
#   - æ— è§„åˆ™åŒ¹é…æ—¶ä½¿ç”¨ default_routing é…ç½®
#
# ğŸ”„ çƒ­æ›´æ–°:
#   ä¿®æ”¹æ­¤æ–‡ä»¶åï¼Œé…ç½®ä¼šåœ¨ä¸‹æ¬¡è¯·æ±‚æ—¶è‡ªåŠ¨ç”Ÿæ•ˆ
#   æ— éœ€é‡å¯æœåŠ¡ï¼ˆç¼“å­˜é»˜è®¤5åˆ†é’Ÿï¼‰
#
# ğŸ“– è¯¦ç»†æ–‡æ¡£:
#   - å¿«é€Ÿå…¥é—¨: ROUTING_QUICK_START.md
#   - å®Œæ•´æŒ‡å—: ROUTING_CONFIG_GUIDE.md
#   - é…ç½®éªŒè¯: lua scripts/validate_routing.lua
# ========================================

# ========================================
# ğŸ“¡ ç¬¬ä¸€éƒ¨åˆ†: CDNèŠ‚ç‚¹å®šä¹‰
# ========================================
# è¯´æ˜:
#   - id: èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†ï¼ˆåœ¨è§„åˆ™ä¸­å¼•ç”¨ï¼‰
#   - name: èŠ‚ç‚¹æ˜¾ç¤ºåç§°ï¼ˆç”¨äºæ—¥å¿—ï¼‰
#   - domain_env/protocol_env/port_env: ä» .env è¯»å–çš„ç¯å¢ƒå˜é‡å
#   - default_*: ç¯å¢ƒå˜é‡æœªè®¾ç½®æ—¶çš„é»˜è®¤å€¼
#
# ç¯å¢ƒå˜é‡é…ç½®ä½ç½®: .env æ–‡ä»¶

cdn_nodes:
  # ç§æœ‰ç½‘ç»œï¼ˆå†…ç½‘/å¼€å‘ç¯å¢ƒï¼‰
  - id: private
    name: ç§æœ‰ç½‘ç»œCDN
    domain_env: CDN_PRIVATE_DOMAIN
    protocol_env: CDN_PRIVATE_PROTOCOL
    port_env: CDN_PRIVATE_PORT
    default_domain: localhost
    default_protocol: http
    default_port: 8080

  # è”é€šCDNï¼ˆä¸­å›½è”é€šç”¨æˆ·ï¼‰
  - id: unicom
    name: è”é€šCDN
    domain_env: CDN_UNICOM_DOMAIN
    protocol_env: CDN_UNICOM_PROTOCOL
    port_env: CDN_UNICOM_PORT
    default_domain: cdn-unicom.example.com
    default_protocol: https

  # ç§»åŠ¨CDNï¼ˆä¸­å›½ç§»åŠ¨ç”¨æˆ·ï¼‰
  - id: mobile
    name: ç§»åŠ¨CDN
    domain_env: CDN_MOBILE_DOMAIN
    protocol_env: CDN_MOBILE_PROTOCOL
    port_env: CDN_MOBILE_PORT
    default_domain: cdn-mobile.example.com
    default_protocol: https

  # ç”µä¿¡CDNï¼ˆä¸­å›½ç”µä¿¡ç”¨æˆ·ï¼‰
  - id: telecom
    name: ç”µä¿¡CDN
    domain_env: CDN_TELECOM_DOMAIN
    protocol_env: CDN_TELECOM_PROTOCOL
    port_env: CDN_TELECOM_PORT
    default_domain: cdn-telecom.example.com
    default_protocol: https

  # å›½å†…CDNï¼ˆå›½å†…é€šç”¨èŠ‚ç‚¹ï¼‰
  - id: china
    name: å›½å†…CDN
    domain_env: CDN_CHINA_DOMAIN
    protocol_env: CDN_CHINA_PROTOCOL
    port_env: CDN_CHINA_PORT
    default_domain: cdn-china.example.com
    default_protocol: https

  # å›½å¤–CDNï¼ˆæµ·å¤–ç”¨æˆ·ï¼‰
  - id: overseas
    name: å›½å¤–CDN
    domain_env: CDN_OVERSEAS_DOMAIN
    protocol_env: CDN_OVERSEAS_PROTOCOL
    port_env: CDN_OVERSEAS_PORT
    default_domain: cdn-overseas.example.com
    default_protocol: https

  # å¤‡ç”¨CDNï¼ˆå¤‡ä»½èŠ‚ç‚¹ï¼‰
  - id: backup
    name: å¤‡ç”¨CDN
    domain_env: CDN_BACKUP_DOMAIN
    protocol_env: CDN_BACKUP_PROTOCOL
    port_env: CDN_BACKUP_PORT
    default_domain: cdn-backup.example.com
    default_protocol: https

  # é»˜è®¤CDNï¼ˆé™çº§/å…œåº•èŠ‚ç‚¹ï¼‰
  - id: default
    name: é»˜è®¤CDN
    domain_env: CDN_DEFAULT_DOMAIN
    protocol_env: CDN_DEFAULT_PROTOCOL
    port_env: CDN_DEFAULT_PORT
    default_domain: cdn.example.com
    default_protocol: https

# ========================================
# ğŸ“‹ ç¬¬äºŒéƒ¨åˆ†: åˆ†æµè§„åˆ™é…ç½®
# ========================================
# è¯´æ˜:
#   - name: è§„åˆ™åç§°ï¼ˆä¾¿äºè¯†åˆ«ï¼Œå»ºè®®å‘½åæ¸…æ™°ï¼‰
#   - priority: ä¼˜å…ˆçº§ï¼ˆ1-999ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
#   - enabled: æ˜¯å¦å¯ç”¨ï¼ˆtrue/falseï¼Œå¯å¿«é€Ÿå¯ç”¨/ç¦ç”¨è§„åˆ™ï¼‰
#   - conditions: åŒ¹é…æ¡ä»¶åˆ—è¡¨ï¼ˆæ‰€æœ‰æ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ï¼‰
#   - target: ç›®æ ‡CDNèŠ‚ç‚¹IDï¼ˆå¿…é¡»åœ¨ cdn_nodes ä¸­å®šä¹‰ï¼‰
#
# ğŸ’¡ ä¼˜å…ˆçº§å»ºè®®:
#   1-10:   å…³é”®ä¸šåŠ¡è§„åˆ™ï¼ˆVIPç”¨æˆ·ã€æµ‹è¯•æµé‡ï¼‰
#   11-50:  åœ°ç†ä½ç½®è§„åˆ™ï¼ˆåœ°åŸŸã€è¿è¥å•†ï¼‰
#   51-100: åŠŸèƒ½æ€§è§„åˆ™ï¼ˆè·¯å¾„ã€æ—¶é—´æ®µï¼‰
#   101+:   å®éªŒæ€§è§„åˆ™ï¼ˆA/Bæµ‹è¯•ã€ç°åº¦ï¼‰
#
# ğŸ“ æ¡ä»¶ç±»å‹æ”¯æŒ:
#   ip_range     - IPåœ°å€æ®µï¼ˆCIDRæ ¼å¼ï¼Œå¦‚ 192.168.0.0/16ï¼‰
#   province     - çœä»½åç§°åˆ—è¡¨
#   isp          - è¿è¥å•†åç§°åˆ—è¡¨
#   country      - å›½å®¶ä»£ç ï¼ˆå¦‚ CNï¼‰
#   asn          - è‡ªæ²»ç³»ç»Ÿå·åˆ—è¡¨
#   path_prefix  - URLè·¯å¾„å‰ç¼€åˆ—è¡¨
#   time_range   - æ—¶é—´èŒƒå›´ï¼ˆstart_hour, end_hourï¼‰
#   percentage   - ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰
#   header       - HTTPè¯·æ±‚å¤´ï¼ˆname, valueï¼‰
#   query_param  - URLå‚æ•°ï¼ˆname, valueï¼‰

routing_rules:
  # ========================================
  # è§„åˆ™1: å†…ç½‘IPä½¿ç”¨ç§æœ‰CDN
  # ä¼˜å…ˆçº§: 10ï¼ˆæœ€é«˜ï¼‰
  # åœºæ™¯: å¼€å‘ç¯å¢ƒã€åŠå…¬ç½‘ç»œ
  # ========================================
  - name: å†…ç½‘IPè·¯ç”±
    priority: 10
    enabled: true
    conditions:
      - type: ip_range
        ranges:
          - 10.0.0.0/8          # Aç±»ç§æœ‰ç½‘ç»œ
          - 172.16.0.0/12       # Bç±»ç§æœ‰ç½‘ç»œ
          - 192.168.0.0/16      # Cç±»ç§æœ‰ç½‘ç»œ
          - 127.0.0.0/8         # æœ¬åœ°å›ç¯
    target: private

  # ========================================
  # è§„åˆ™2: ç”µä¿¡ç”¨æˆ·ä½¿ç”¨ç”µä¿¡CDN
  # ä¼˜å…ˆçº§: 20
  # åœºæ™¯: ä¼˜åŒ–ç”µä¿¡ç”¨æˆ·è®¿é—®é€Ÿåº¦
  # ========================================
  - name: ç”µä¿¡ç”¨æˆ·
    priority: 20
    enabled: true
    conditions:
      - type: isp
        values:
          - China Telecom
          - ChinaNet
          - ç”µä¿¡
    target: telecom

  # ========================================
  # è§„åˆ™3: è”é€šç”¨æˆ·ä½¿ç”¨è”é€šCDN
  # ä¼˜å…ˆçº§: 30
  # åœºæ™¯: ä¼˜åŒ–è”é€šç”¨æˆ·è®¿é—®é€Ÿåº¦
  # ========================================
  - name: è”é€šç”¨æˆ·
    priority: 30
    enabled: true
    conditions:
      - type: isp
        values:
          - China Unicom
          - è”é€š
    target: unicom

  # ========================================
  # è§„åˆ™4: ç§»åŠ¨ç”¨æˆ·ä½¿ç”¨ç§»åŠ¨CDN
  # ä¼˜å…ˆçº§: 40
  # åœºæ™¯: ä¼˜åŒ–ç§»åŠ¨ç”¨æˆ·è®¿é—®é€Ÿåº¦
  # ========================================
  - name: ç§»åŠ¨ç”¨æˆ·
    priority: 40
    enabled: true
    conditions:
      - type: isp
        values:
          - China Mobile
          - ç§»åŠ¨
    target: mobile

  # ========================================
  # è§„åˆ™5: æµ·å¤–IPä½¿ç”¨å›½å¤–CDN
  # ä¼˜å…ˆçº§: 50
  # åœºæ™¯: å›½é™…ç”¨æˆ·è®¿é—®åŠ é€Ÿ
  # ========================================
  - name: æµ·å¤–è®¿é—®
    priority: 50
    enabled: true
    conditions:
      - type: country
        operator: not_equals
        value: CN
    target: overseas

  # ========================================
  # è§„åˆ™6: å›½å†…å…¶ä»–ç”¨æˆ·ä½¿ç”¨å›½å†…CDN
  # ä¼˜å…ˆçº§: 60
  # åœºæ™¯: å›½å†…éä¸‰å¤§è¿è¥å•†ç”¨æˆ·
  # ========================================
  - name: å›½å†…é€šç”¨
    priority: 60
    enabled: true
    conditions:
      - type: country
        value: CN
    target: china

  # ========================================
  # è§„åˆ™7: æ—¶é—´æ®µè·¯ç”±ï¼ˆç¤ºä¾‹ï¼šå¤œé—´ä½¿ç”¨å¤‡ä»½æœåŠ¡å™¨ï¼‰
  # ========================================
  - name: å¤œé—´å¤‡ä»½è·¯ç”±
    priority: 70
    enabled: false  # é»˜è®¤ç¦ç”¨
    conditions:
  # ========================================
  # é«˜çº§è§„åˆ™ç¤ºä¾‹ï¼ˆé»˜è®¤ç¦ç”¨ï¼ŒæŒ‰éœ€å¯ç”¨ï¼‰
  # ========================================

  # è§„åˆ™: å¤œé—´ç»´æŠ¤çª—å£ä½¿ç”¨å¤‡ä»½CDN
  # ä¼˜å…ˆçº§: 70
  # åœºæ™¯: ä¸»CDNå¤œé—´ç»´æŠ¤æ—¶çš„æµé‡åˆ‡æ¢
  - name: å¤œé—´å¤‡ä»½è·¯ç”±
    priority: 70
    enabled: false  # éœ€è¦æ—¶å¯ç”¨
    conditions:
      - type: time_range
        start_hour: 2    # å‡Œæ™¨2ç‚¹
        end_hour: 6      # æ—©ä¸Š6ç‚¹
    target: backup

  # è§„åˆ™: A/Bæµ‹è¯•åˆ†æµ
  # ä¼˜å…ˆçº§: 80
  # åœºæ™¯: æ–°CDNç°åº¦å‘å¸ƒã€æ€§èƒ½å¯¹æ¯”æµ‹è¯•
  - name: ABæµ‹è¯•åˆ†æµ
    priority: 80
    enabled: false  # éœ€è¦æ—¶å¯ç”¨
    conditions:
      - type: percentage
        value: 20  # 20%çš„æµé‡åˆ°æ–°CDN
    target: backup

  # è§„åˆ™: å®¢æˆ·ç«¯æŒ‡å®šCDN
  # ä¼˜å…ˆçº§: 90
  # åœºæ™¯: å…è®¸å®¢æˆ·ç«¯é€šè¿‡HeaderæŒ‡å®šCDN
  - name: è‡ªå®šä¹‰Headerè·¯ç”±
    priority: 90
    enabled: false  # éœ€è¦æ—¶å¯ç”¨
    conditions:
      - type: header
        name: X-CDN-Prefer
        value: backup
    target: backup

  # è§„åˆ™: URLå‚æ•°åŠ¨æ€è·¯ç”±
  # ä¼˜å…ˆçº§: 100
  # åœºæ™¯: è°ƒè¯•ã€æµ‹è¯•ç‰¹å®šCDN
  # ä½¿ç”¨: http://short.domain.com/abc?cdn=overseas
  - name: URLå‚æ•°è·¯ç”±
    priority: 100
    enabled: false  # éœ€è¦æ—¶å¯ç”¨
    conditions:
      - type: query_param
        name: cdn
        value: overseas
    target: overseas

# ========================================
# ğŸ”„ ç¬¬ä¸‰éƒ¨åˆ†: é»˜è®¤è·¯ç”±å’Œé™çº§ç­–ç•¥
# ========================================
# è¯´æ˜:
#   - target: æ— è§„åˆ™åŒ¹é…æ—¶ä½¿ç”¨çš„é»˜è®¤CDN
#   - fallback_chain: CDNæ•…éšœæ—¶çš„é™çº§é¡ºåº
#
# é™çº§é€»è¾‘:
#   1. å°è¯•ä½¿ç”¨è§„åˆ™åŒ¹é…çš„ç›®æ ‡CDN
#   2. å¦‚æœç›®æ ‡CDNä¸å¯ç”¨ï¼ŒæŒ‰é™çº§é“¾é¡ºåºå°è¯•
#   3. æ‰€æœ‰CDNéƒ½ä¸å¯ç”¨æ—¶è¿”å›é”™è¯¯

default_routing:
  # é»˜è®¤ç›®æ ‡CDNï¼ˆæ¨èä½¿ç”¨æœ€ç¨³å®šçš„èŠ‚ç‚¹ï¼‰
  target: default

  # é™çº§é“¾ï¼ˆä»å·¦åˆ°å³ä¾æ¬¡å°è¯•ï¼‰
  fallback_chain:
    - china         # é¦–é€‰: å›½å†…CDN
    - backup        # æ¬¡é€‰: å¤‡ç”¨CDN
    - default       # å…œåº•: é»˜è®¤CDN

# ========================================
# âš™ï¸ ç¬¬å››éƒ¨åˆ†: é«˜çº§é…ç½®
# ========================================
# è¯´æ˜:
#   æ€§èƒ½ä¼˜åŒ–ã€æ—¥å¿—æ§åˆ¶ã€å¥åº·æ£€æŸ¥ç­‰é«˜çº§é€‰é¡¹

advanced:
  # è§„åˆ™ç¼“å­˜ï¼ˆæé«˜æ€§èƒ½ï¼‰
  enable_rule_cache: true
  cache_ttl: 300  # ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤5åˆ†é’Ÿ

  # è·¯ç”±æ—¥å¿—ï¼ˆè°ƒè¯•ç”¨ï¼‰
  # ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ä»¥æå‡æ€§èƒ½
  enable_routing_log: false

  # å¥åº·æ£€æŸ¥
  enable_health_check: true
  health_check_interval: 30  # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰

  # å¤±è´¥é‡è¯•
  max_retries: 3      # æœ€å¤§é‡è¯•æ¬¡æ•°
  retry_delay: 1      # é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰

# ========================================
# ğŸ“ é…ç½®ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
# ========================================
#
# ç¤ºä¾‹1: ç®€å•å†…å¤–ç½‘åˆ†æµ
# ----------------------------
# routing_rules:
#   - name: å†…ç½‘ç”¨æˆ·
#     priority: 10
#     enabled: true
#     conditions:
#       - type: ip_range
#         ranges: [192.168.0.0/16]
#     target: private
#
#   - name: å¤–ç½‘ç”¨æˆ·ï¼ˆé»˜è®¤ï¼‰
#     priority: 100
#     enabled: true
#     conditions: []
#     target: public
#
# ç¤ºä¾‹2: ç”µä¿¡è”é€šåˆ†æµ
# ----------------------------
# routing_rules:
#   - name: ç”µä¿¡ç”¨æˆ·
#     priority: 20
#     enabled: true
#     conditions:
#       - type: isp
#         values: [China Telecom]
#     target: telecom_cdn
#
#   - name: è”é€šç”¨æˆ·
#     priority: 30
#     enabled: true
#     conditions:
#       - type: isp
#         values: [China Unicom]
#     target: unicom_cdn
#
# ç¤ºä¾‹3: å¤æ‚ç»„åˆæ¡ä»¶
# ----------------------------
# routing_rules:
#   - name: åŒ—äº¬ç”µä¿¡VIPç”¨æˆ·
#     priority: 5
#     enabled: true
#     conditions:
#       - type: province
#         values: [åŒ—äº¬]
#       - type: isp
#         values: [China Telecom]
#       - type: header
#         name: X-User-Level
#         value: VIP
#     target: vip_cdn
#
# ğŸ’¡ æœ€ä½³å®è·µ:
#   1. ä¼˜å…ˆçº§è®¾ç½®: å…³é”®è§„åˆ™1-10ï¼Œåœ°åŸŸè§„åˆ™11-50ï¼ŒåŠŸèƒ½è§„åˆ™51-100
#   2. è§„åˆ™å‘½å: ä½¿ç”¨æ¸…æ™°æè¿°æ€§çš„åç§°ï¼Œä¾¿äºç»´æŠ¤
#   3. æ¡ä»¶ç»„åˆ: å¤šä¸ªæ¡ä»¶æ˜¯ANDå…³ç³»ï¼Œéƒ½è¦æ»¡è¶³æ‰åŒ¹é…
#   4. æµ‹è¯•è§„åˆ™: ä½¿ç”¨ enabled:false æš‚æ—¶ç¦ç”¨ï¼Œè€Œä¸æ˜¯åˆ é™¤
#   5. é™çº§ç­–ç•¥: é…ç½®å¤šä¸ªå¤‡é€‰CDNï¼Œç¡®ä¿é«˜å¯ç”¨
#   6. æ€§èƒ½ä¼˜åŒ–: ç”Ÿäº§ç¯å¢ƒå…³é—­è·¯ç”±æ—¥å¿—ï¼Œå¯ç”¨ç¼“å­˜
#   7. ç°åº¦å‘å¸ƒ: ä½¿ç”¨ percentage æ¡ä»¶é€æ­¥åˆ‡æ¢CDN
#
# ========================================
