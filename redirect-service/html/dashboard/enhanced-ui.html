<!-- çŸ­é“¾ç®¡ç†ç³»ç»Ÿ - å¢å¼ºUIç»„ä»¶ -->
<!-- æ–‡ä»¶: html/dashboard/enhanced-ui.html -->
<!-- åŠŸèƒ½: æ‰¹é‡æ“ä½œæ ã€é«˜çº§æœç´¢ã€å¯¼å…¥å¯¼å‡ºã€å›æ”¶ç«™ç­‰UIç»„ä»¶ -->

<!-- ========================================
     æ‰¹é‡æ“ä½œæ 
     ======================================== -->
<div id="batch-action-bar" class="batch-action-bar" style="display: none;">
  <div class="batch-info">
    <span id="selected-count">å·²é€‰æ‹© 0 ä¸ª</span>
  </div>
  <div class="batch-actions">
    <button id="batch-export-btn" class="btn btn-sm" onclick="batchExport()" disabled>
      ğŸ“¤ å¯¼å‡ºé€‰ä¸­
    </button>
    <button id="batch-update-btn" class="btn btn-sm" onclick="batchUpdateStatus()" disabled>
      âœï¸ æ‰¹é‡æ›´æ–°
    </button>
    <button id="batch-delete-btn" class="btn btn-sm btn-danger" onclick="batchDelete()" disabled>
      ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤
    </button>
  </div>
</div>

<!-- ========================================
     é«˜çº§æœç´¢æ¨¡æ€æ¡†
     ======================================== -->
<div id="advanced-search-modal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h3>ğŸ” é«˜çº§æœç´¢</h3>
      <button class="modal-close" onclick="hideAdvancedSearch()">&times;</button>
    </div>
    
    <form id="advanced-search-form" onsubmit="event.preventDefault(); applyAdvancedSearch();">
      <div class="modal-body">
        <!-- çŸ­é“¾ç æœç´¢ -->
        <div class="form-group">
          <label>çŸ­é“¾ç </label>
          <input type="text" name="search_code" placeholder="æ”¯æŒæ¨¡ç³Šæœç´¢" />
        </div>
        
        <!-- æœåŠ¡ç±»å‹ -->
        <div class="form-group">
          <label>æœåŠ¡ç±»å‹</label>
          <select name="search_service_type">
            <option value="">å…¨éƒ¨ç±»å‹</option>
            <option value="imagebed">å›¾åºŠ</option>
            <option value="general">é€šç”¨</option>
            <option value="file">æ–‡ä»¶</option>
            <option value="video">è§†é¢‘</option>
          </select>
        </div>
        
        <!-- çŠ¶æ€ -->
        <div class="form-group">
          <label>çŠ¶æ€</label>
          <select name="search_status">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="active">æ´»è·ƒ</option>
            <option value="paused">æš‚åœ</option>
            <option value="deleted">å·²åˆ é™¤</option>
          </select>
        </div>
        
        <!-- åˆ›å»ºæ—¶é—´èŒƒå›´ -->
        <div class="form-row">
          <div class="form-group">
            <label>åˆ›å»ºæ—¶é—´ï¼ˆä»ï¼‰</label>
            <input type="date" name="search_date_from" />
          </div>
          <div class="form-group">
            <label>åˆ›å»ºæ—¶é—´ï¼ˆåˆ°ï¼‰</label>
            <input type="date" name="search_date_to" />
          </div>
        </div>
        
        <!-- è®¿é—®é‡èŒƒå›´ -->
        <div class="form-row">
          <div class="form-group">
            <label>æœ€å°è®¿é—®é‡</label>
            <input type="number" name="search_visit_min" min="0" placeholder="0" />
          </div>
          <div class="form-group">
            <label>æœ€å¤§è®¿é—®é‡</label>
            <input type="number" name="search_visit_max" min="0" placeholder="ä¸é™" />
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="clearSearch()">
          ğŸ”„ é‡ç½®
        </button>
        <button type="submit" class="btn btn-primary">
          ğŸ” æœç´¢
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ========================================
     å¯¼å…¥æ¨¡æ€æ¡†
     ======================================== -->
<div id="import-modal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h3>ğŸ“¥ æ‰¹é‡å¯¼å…¥çŸ­é“¾</h3>
      <button class="modal-close" onclick="hideImportDialog()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="import-section">
        <h4>ğŸ“„ é€‰æ‹©æ–‡ä»¶</h4>
        <p class="help-text">æ”¯æŒ CSV å’Œ JSON æ ¼å¼æ–‡ä»¶</p>
        
        <div class="file-upload-area">
          <input 
            type="file" 
            id="import-file" 
            accept=".csv,.json" 
            onchange="handleFileSelect(event)"
            style="display: none;"
          />
          <label for="import-file" class="file-upload-btn">
            ğŸ“ é€‰æ‹©æ–‡ä»¶
          </label>
        </div>
      </div>
      
      <div class="import-section">
        <h4>ğŸ“‹ ä¸‹è½½æ¨¡æ¿</h4>
        <p class="help-text">ä¸‹è½½æ ‡å‡†æ¨¡æ¿æ–‡ä»¶ï¼Œå¡«å†™æ•°æ®åå¯¼å…¥</p>
        
        <div class="template-buttons">
          <button class="btn btn-sm" onclick="downloadTemplate('csv')">
            ğŸ“„ CSV æ¨¡æ¿
          </button>
          <button class="btn btn-sm" onclick="downloadTemplate('json')">
            ğŸ“„ JSON æ¨¡æ¿
          </button>
        </div>
      </div>
      
      <div class="import-section">
        <h4>â„¹ï¸ å¯¼å…¥è¯´æ˜</h4>
        <ul class="import-help">
          <li>CSV æ ¼å¼ï¼šçŸ­é“¾ç ,æœåŠ¡ç±»å‹,ç›®æ ‡è·¯å¾„,ç­–ç•¥,è¿‡æœŸæ—¶é—´,å¤‡æ³¨</li>
          <li>JSON æ ¼å¼ï¼šå‚è€ƒæ¨¡æ¿æ–‡ä»¶ç»“æ„</li>
          <li>å•æ¬¡æœ€å¤šå¯¼å…¥ 1000 æ¡è®°å½•</li>
          <li>é‡å¤çš„çŸ­é“¾ç ä¼šè‡ªåŠ¨è·³è¿‡</li>
          <li>å¯¼å…¥å‰è¯·ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®</li>
        </ul>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="hideImportDialog()">
        å…³é—­
      </button>
    </div>
  </div>
</div>

<!-- ========================================
     å›æ”¶ç«™æ¨¡æ€æ¡†
     ======================================== -->
<div id="trash-modal" class="modal">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h3>ğŸ—‘ï¸ å›æ”¶ç«™</h3>
      <button class="modal-close" onclick="closeModal('trash-modal')">&times;</button>
    </div>
    
    <div class="modal-body">
      <p class="help-text">
        å·²åˆ é™¤çš„çŸ­é“¾ä¼šåœ¨è¿™é‡Œä¿ç•™ 30 å¤©ï¼Œä¹‹åè‡ªåŠ¨æ°¸ä¹…åˆ é™¤ã€‚
      </p>
      
      <table id="trash-table" class="data-table">
        <thead>
          <tr>
            <th>çŸ­é“¾ç </th>
            <th>ç±»å‹</th>
            <th>è®¿é—®é‡</th>
            <th>åˆ é™¤æ—¶é—´</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="5" style="text-align:center;">åŠ è½½ä¸­...</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('trash-modal')">
        å…³é—­
      </button>
    </div>
  </div>
</div>

<!-- ========================================
     æ‰¹é‡æ›´æ–°çŠ¶æ€æ¨¡æ€æ¡†
     ======================================== -->
<div id="batch-update-modal" class="modal">
  <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
      <h3>âœï¸ æ‰¹é‡æ›´æ–°çŠ¶æ€</h3>
      <button class="modal-close" onclick="closeModal('batch-update-modal')">&times;</button>
    </div>
    
    <form onsubmit="event.preventDefault(); confirmBatchUpdate();">
      <div class="modal-body">
        <div class="form-group">
          <label>æ–°çŠ¶æ€</label>
          <select id="batch-status-select" required>
            <option value="active">æ´»è·ƒ</option>
            <option value="paused">æš‚åœ</option>
          </select>
        </div>
        
        <div class="info-box">
          <p>
            <strong>å°†æ›´æ–° <span id="batch-update-count">0</span> ä¸ªçŸ­é“¾çš„çŠ¶æ€</strong>
          </p>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('batch-update-modal')">
          å–æ¶ˆ
        </button>
        <button type="submit" class="btn btn-primary">
          ç¡®è®¤æ›´æ–°
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ========================================
     æ ·å¼å®šä¹‰
     ======================================== -->
<style>
  /* æ‰¹é‡æ“ä½œæ  */
  .batch-action-bar {
    position: sticky;
    top: 0;
    z-index: 100;
    background: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: 8px;
    padding: 12px 20px;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
  }
  
  .batch-info {
    font-weight: 500;
    color: #856404;
  }
  
  .batch-actions {
    display: flex;
    gap: 8px;
  }
  
  /* å¤é€‰æ¡†æ ·å¼ */
  .link-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
    margin-right: 8px;
  }
  
  .select-all-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  
  /* è¡¨å•è¡Œ */
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  
  /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
  .file-upload-area {
    border: 2px dashed #d9d9d9;
    border-radius: 8px;
    padding: 40px;
    text-align: center;
    background: #fafafa;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .file-upload-area:hover {
    border-color: #1890ff;
    background: #f0f9ff;
  }
  
  .file-upload-btn {
    display: inline-block;
    padding: 12px 24px;
    background: #1890ff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  .file-upload-btn:hover {
    background: #40a9ff;
  }
  
  /* å¯¼å…¥åŒºåŸŸ */
  .import-section {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .import-section:last-child {
    border-bottom: none;
  }
  
  .import-section h4 {
    margin-bottom: 8px;
    font-size: 16px;
    color: #333;
  }
  
  .help-text {
    color: #666;
    font-size: 14px;
    margin-bottom: 12px;
  }
  
  .template-buttons {
    display: flex;
    gap: 12px;
  }
  
  .import-help {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .import-help li {
    padding: 6px 0;
    padding-left: 20px;
    position: relative;
    color: #666;
    font-size: 14px;
  }
  
  .import-help li:before {
    content: "â€¢";
    position: absolute;
    left: 0;
    color: #1890ff;
    font-weight: bold;
  }
  
  /* ä¿¡æ¯æ¡† */
  .info-box {
    background: #e6f7ff;
    border: 1px solid #91d5ff;
    border-radius: 4px;
    padding: 12px;
    margin-top: 12px;
  }
  
  .info-box p {
    margin: 0;
    color: #0050b3;
  }
  
  /* æ•°æ®è¡¨æ ¼ */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
  }
  
  .data-table th {
    background: #fafafa;
    padding: 12px;
    text-align: left;
    font-weight: 500;
    border-bottom: 2px solid #f0f0f0;
  }
  
  .data-table td {
    padding: 12px;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .data-table tbody tr:hover {
    background: #fafafa;
  }
  
  /* æŒ‰é’®å°ºå¯¸ */
  .btn-sm {
    padding: 6px 12px;
    font-size: 13px;
  }
  
  /* æ¿€æ´»çŠ¶æ€ */
  .btn.active {
    background: #52c41a;
    color: white;
    border-color: #52c41a;
  }
  
  .btn.active:hover {
    background: #73d13d;
    border-color: #73d13d;
  }
</style>

<!-- ========================================
     å¢å¼ºåŠŸèƒ½è„šæœ¬
     ======================================== -->
<script>
  // æ‰¹é‡æ›´æ–°çŠ¶æ€
  async function batchUpdateStatus() {
    if (selectedLinks.size === 0) {
      showNotification('è¯·å…ˆé€‰æ‹©è¦æ›´æ–°çš„çŸ­é“¾', 'warning');
      return;
    }
    
    document.getElementById('batch-update-count').textContent = selectedLinks.size;
    openModal('batch-update-modal');
  }
  
  // ç¡®è®¤æ‰¹é‡æ›´æ–°
  async function confirmBatchUpdate() {
    const newStatus = document.getElementById('batch-status-select').value;
    const codes = Array.from(selectedLinks);
    
    let successCount = 0;
    let failedCount = 0;
    
    showNotification(`æ­£åœ¨æ›´æ–° ${codes.length} ä¸ªçŸ­é“¾...`, 'info');
    closeModal('batch-update-modal');
    
    for (const code of codes) {
      try {
        await request(`${API_BASE}/${code}`, {
          method: 'PUT',
          body: JSON.stringify({ status: newStatus })
        });
        successCount++;
      } catch (error) {
        failedCount++;
        console.error(`æ›´æ–° ${code} å¤±è´¥:`, error);
      }
    }
    
    if (successCount > 0) {
      showNotification(
        `âœ… æˆåŠŸæ›´æ–° ${successCount} ä¸ª${failedCount > 0 ? `ï¼Œ${failedCount} ä¸ªå¤±è´¥` : ''}`,
        'success'
      );
      selectedLinks.clear();
      updateBatchCount();
      refreshLinks();
    } else {
      showNotification('âŒ æ›´æ–°å¤±è´¥', 'error');
    }
  }
  
  // æ‰“å¼€/å…³é—­æ¨¡æ€æ¡†è¾…åŠ©å‡½æ•°
  function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = 'block';
    }
  }
  
  function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = 'none';
    }
  }
</script>
