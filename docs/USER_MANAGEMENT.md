# 用户管理功能文档

## 概述

TC-GO 图床系统现已支持完整的用户管理功能，包括用户状态管理、统计信息、个人资料编辑和密码管理。

## 后端新增功能

### 1. 用户模型扩展

新增字段：
- `status` - 用户状态（active/disabled）
- `avatar` - 用户头像 URL
- `bio` - 个人简介
- `lastLogin` - 最后登录时间
- `loginIP` - 最后登录 IP

新增结构：
- `UserStats` - 用户统计信息（图片数、相册数、存储空间、浏览量、下载量）

### 2. 用户管理 API（管理员权限）

#### 获取用户列表（支持分页和筛选）
```
GET /api/users?page=1&pageSize=20&keyword=xxx&status=active&role=admin
```

**查询参数：**
- `page` - 页码（默认 1）
- `pageSize` - 每页数量（默认 20，最大 100）
- `keyword` - 搜索关键词（用户名或邮箱）
- `status` - 状态筛选（active/disabled）
- `role` - 角色筛选（admin/user）

**响应示例：**
```json
{
  "data": {
    "users": [...],
    "total": 100,
    "page": 1,
    "pageSize": 20
  }
}
```

#### 获取用户详情
```
GET /api/users/:id
```

#### 获取用户统计信息
```
GET /api/users/:id/stats
```

**响应示例：**
```json
{
  "data": {
    "userId": 1,
    "totalImages": 150,
    "totalAlbums": 10,
    "totalStorage": 52428800,
    "totalViews": 5000,
    "totalDownloads": 500
  }
}
```

#### 更新用户状态
```
PUT /api/users/:id/status
Content-Type: application/json

{
  "status": "disabled"
}
```

**注意：** 不能禁用自己的账号

#### 重置用户密码（管理员）
```
POST /api/users/:id/reset-password
Content-Type: application/json

{
  "newPassword": "new_password_here"
}
```

**密码要求：** 至少 6 个字符

### 3. 个人资料 API（所有用户）

#### 更新个人资料
```
PUT /api/profile
Content-Type: application/json

{
  "avatar": "https://example.com/avatar.jpg",
  "bio": "This is my bio"
}
```

#### 修改密码
```
POST /api/profile/change-password
Content-Type: application/json

{
  "oldPassword": "current_password",
  "newPassword": "new_password"
}
```

**验证规则：**
- 必须提供正确的当前密码
- 新密码至少 6 个字符

## 前端新增功能

### 1. 增强的用户管理页面 (`/users`)

**新增功能：**
- ✅ 搜索框 - 按用户名或邮箱搜索
- ✅ 状态筛选 - 筛选启用/禁用用户
- ✅ 角色筛选 - 筛选管理员/普通用户
- ✅ 分页控制 - 支持 10/20/50/100 每页
- ✅ 用户详情对话框 - 查看完整用户信息和统计
- ✅ 状态切换按钮 - 启用/禁用用户
- ✅ 重置密码功能 - 管理员可重置用户密码
- ✅ 最后登录时间显示

**用户详情包含：**
- 基本信息：ID、用户名、邮箱、角色、状态
- 时间信息：注册时间、最后登录时间、登录 IP
- 个人资料：头像、个人简介
- 统计数据：图片数、相册数、存储空间、浏览量、下载量

### 2. 个人资料页面 (`/profile`)

**个人信息卡片：**
- 查看基本信息（用户名、邮箱、角色等）
- 编辑头像 URL
- 编辑个人简介
- 查看注册时间和最后登录时间

**修改密码卡片：**
- 输入当前密码验证身份
- 设置新密码（至少 6 位）
- 密码确认验证

**统计信息卡片：**
- 显示个人图片数量
- 显示个人相册数量
- 显示使用的存储空间
- 显示总浏览量和下载量

### 3. 导航菜单更新

在顶部工具栏的用户下拉菜单中添加了"个人信息"入口，点击可跳转到个人资料页面。

## 使用示例

### 管理员操作示例

1. **查看所有启用的管理员用户：**
   - 进入"用户管理"页面
   - 状态筛选选择"启用"
   - 角色筛选选择"管理员"

2. **禁用某个用户：**
   - 在用户列表中找到目标用户
   - 点击"禁用"按钮
   - 确认操作

3. **重置用户密码：**
   - 点击用户的"重置密码"按钮
   - 输入新密码并确认
   - 点击确定

4. **查看用户详细统计：**
   - 点击用户的"详情"按钮
   - 查看用户信息和统计数据

### 普通用户操作示例

1. **更新个人资料：**
   - 点击顶部用户名 → "个人信息"
   - 点击"编辑"按钮
   - 修改头像或简介
   - 点击"保存"

2. **修改密码：**
   - 进入个人资料页面
   - 在"修改密码"卡片中输入当前密码
   - 输入新密码并确认
   - 点击"修改密码"

3. **查看个人统计：**
   - 进入个人资料页面
   - 在"我的统计"卡片中查看数据

## 安全特性

1. **权限控制：**
   - 用户管理功能仅限管理员访问
   - 个人资料功能所有用户可访问
   - 用户只能修改自己的资料

2. **自我保护：**
   - 管理员不能删除或禁用自己的账号
   - 修改密码需要验证当前密码

3. **密码安全：**
   - 所有密码使用 bcrypt 加密
   - 密码最小长度要求 6 位

4. **错误处理：**
   - 统一错误响应格式
   - 友好的错误提示信息

## 数据库优化

新增索引：
- `users.status` - 加速状态查询
- `users.email` - 加速邮箱搜索
- `users.username` - 加速用户名搜索

支持分页查询，避免大量数据加载导致的性能问题。

## 未来计划

- [ ] 头像上传功能（当前需要提供 URL）
- [ ] 用户组和权限细粒度控制
- [ ] 用户活动日志
- [ ] 批量用户操作
- [ ] 导出用户数据
- [ ] 用户注册邀请码系统
